<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VCF 2V0-13.25 – Quiz</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;background:#0b1020;color:#e8eefc;margin:0}
    header{position:sticky;top:0;background:#0f1630;border-bottom:1px solid #1f2a52;padding:12px 14px;z-index:10}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{padding:6px 10px;border:1px solid #2a3a72;border-radius:999px;background:#111a38;color:#cfe0ff;font-size:13px}
    main{padding:14px;max-width:900px;margin:0 auto}
    .card{background:#0f1430;border:1px solid #1f2a52;border-radius:14px;padding:14px}
    .qhead{display:flex;justify-content:space-between;gap:10px;align-items:flex-start;margin-bottom:10px}
    .qnum{font-weight:800}
    .qtext{margin:8px 0 12px;line-height:1.6}
    .opt{display:flex;gap:10px;align-items:flex-start;background:#0c1128;border:1px solid #1f2a52;border-radius:12px;padding:10px;margin:10px 0}
    .opt input{margin-top:4px;transform:scale(1.1)}
    .btn{background:#1a2636;color:#e9eef5;border:1px solid #2a3a72;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .bar{display:flex;gap:10px;justify-content:space-between;margin-top:12px;flex-wrap:wrap}
    .feedback{margin-top:12px;padding:10px;border-radius:12px;border:1px solid #2a3a72;background:#0b1230}
    .good{border-color:#245c39}
    .bad{border-color:#6b2b2b}
    .muted{color:#a9b7d6;font-size:13px}
    a{color:#9cc3ff}
  </style>
</head>
<body>
  <header>
    <div class="row">
      <span class="pill" id="titlePill">VCF 2V0-13.25</span>
      <span class="pill" id="counterPill">السؤال: 0/0</span>
      <span class="pill" id="modePill">Choose one</span>
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="prevBtn">Prev</button>
      <button class="btn" id="nextBtn" disabled>Next</button>
      <button class="btn" id="finishBtn">Finish</button>
      <span class="muted" id="status"></span>
    </div>
  </header>

  <main>
    <div class="card" id="card">
      <div class="qhead">
        <div>
          <div class="qnum" id="qnum">Question</div>
          <div class="muted" id="qtype"></div>
        </div>
      </div>
      <div class="qtext" id="qtext">تحميل الأسئلة…</div>
      <div id="opts"></div>
      <div class="feedback" id="feedback" style="display:none"></div>
      <div class="bar">
        <div class="muted" id="hint"></div>
        <div class="muted">مصدر الأسئلة: <a href="questions.json">questions.json</a></div>
      </div>
    </div>
  </main>

<script>
let QUESTIONS = [];
let idx = 0;
let picked = null;

const el = (id)=>document.getElementById(id);
const qnum = el("qnum"), qtype = el("qtype"), qtext = el("qtext"), opts = el("opts");
const counterPill = el("counterPill"), modePill = el("modePill"), feedback = el("feedback");
const prevBtn = el("prevBtn"), nextBtn = el("nextBtn"), finishBtn = el("finishBtn"), status = el("status"), hint = el("hint");

function render(){
  if(!QUESTIONS.length){
    qnum.textContent = "No Questions";
    qtype.textContent = "";
    qtext.textContent = "ملف questions.json فاضي أو ما انقرأ. افتحه وعدّل الأسئلة.";
    opts.innerHTML = "";
    counterPill.textContent = "السؤال: 0/0";
    modePill.textContent = "-";
    prevBtn.disabled = true;
    nextBtn.disabled = true;
    return;
  }

  const q = QUESTIONS[idx];
  picked = null;
  feedback.style.display = "none";
  feedback.className = "feedback";

  counterPill.textContent = `السؤال: ${idx+1}/${QUESTIONS.length}`;
  qnum.textContent = `Question ${idx+1}`;
  qtype.textContent = q.type || "Choose one";
  modePill.textContent = q.type || "Choose one";
  qtext.textContent = q.q || "(بدون نص سؤال)";

  opts.innerHTML = "";
  (q.choices || []).forEach((c, i)=>{
    const wrap = document.createElement("label");
    wrap.className = "opt";
    const input = document.createElement("input");
    input.type = (q.type && q.type.toLowerCase().includes("multiple")) ? "checkbox" : "radio";
    input.name = "choice";
    input.value = i;
    input.addEventListener("change", ()=>{
      if(input.type === "radio"){
        picked = [i];
      } else {
        // checkboxes
        const chosen = [...opts.querySelectorAll("input[type=checkbox]:checked")].map(x=>Number(x.value));
        picked = chosen;
      }
      nextBtn.disabled = !picked || picked.length===0;
    });

    const span = document.createElement("div");
    span.textContent = c || "(خيار فاضي)";
    wrap.appendChild(input);
    wrap.appendChild(span);
    opts.appendChild(wrap);
  });

  prevBtn.disabled = idx===0;
  nextBtn.disabled = true;
  hint.textContent = "اختر إجابة ثم اضغط Next للتصحيح.";
}

function sameSet(a,b){
  if(!Array.isArray(a) || !Array.isArray(b)) return false;
  const aa = [...a].sort((x,y)=>x-y);
  const bb = [...b].sort((x,y)=>x-y);
  return aa.length===bb.length && aa.every((v,i)=>v===bb[i]);
}

function grade(){
  const q = QUESTIONS[idx];
  const ans = Array.isArray(q.answer) ? q.answer : [q.answer];
  const ok = sameSet(picked||[], ans);

  feedback.style.display = "block";
  feedback.classList.add(ok ? "good" : "bad");
  const correctText = ans.map(i => (q.choices && q.choices[i]) ? q.choices[i] : `#${i}`).join(" | ");
  const expl = q.explain ? `<div style="margin-top:8px" class="muted">${q.explain}</div>` : "";
  feedback.innerHTML = (ok ? "✅ صحيح" : "❌ خطأ") + `<div class="muted" style="margin-top:6px">الصحيح: ${correctText}</div>` + expl;
}

prevBtn.onclick = ()=>{ if(idx>0){ idx--; render(); } };
nextBtn.onclick = ()=>{ grade(); if(idx < QUESTIONS.length-1){ idx++; setTimeout(render, 350); } };
finishBtn.onclick = ()=>{ status.textContent = "خلصت."; };

(async function init(){
  try{
    const res = await fetch("questions.json", {cache:"no-store"});
    QUESTIONS = await res.json();
    if(!Array.isArray(QUESTIONS)) QUESTIONS = [];
    status.textContent = "";
  }catch(e){
    QUESTIONS = [];
    status.textContent = "ما قدرت أقرأ questions.json";
  }
  render();
})();
</script>
</body>
</html>